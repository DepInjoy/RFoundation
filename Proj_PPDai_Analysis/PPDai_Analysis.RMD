---
拍拍贷用户数据探索
========================================================
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
```
本文针对拍拍贷业务数据进行分析，该数据包包含了成交时间从2015年1月1日到2017年1月30日的328553支信用标，主要有三个csv数据集文件构成：

- LC(Loan Characteristics)表，标的特征表，每支标一条记录。共有21个字段，包括一个主键（listingid）、7个标的特征和13个成交当时的借款人信息，全部为成交当时可以获得的信息。

- LP(Loan Periodic) 表，标的还款计划和还款记录，每支标每期还款为一条记录。还款记录和状态更新至2017年2月22日。共有10个字段，包括两个主键（listingid和期数），3个还款计划字段和4个还款状态字段。

- LCIS(Loan Characteristics Investment Status)表：

```{r message=FALSE, warning=FALSE, packages}
library(ggplot2)
library(gridExtra)
library(dplyr)
library(lubridate)
# 设置数据显示非科学计数法
options(scipen=3)
```

```{r Load_the_Data}
# 加载数据
lc <- read.csv("ppdai/LC.csv", fileEncoding = "utf-8")
lp <- read.csv("ppdai/LP.csv", fileEncoding = "utf-8")
lcis <- read.csv("ppdai/LCIS.csv", fileEncoding = "utf-8")
```

```{r}
str(lc)
```
```{r warning=FALSE, message = FALSE}
str(lp)
```
```{r warning=FALSE, message=FALSE}
str(lcis)
```
## 数据评估和清洗
```{r}
# 观察是否有重复的数据，无重复数据，无须处理
sum(duplicated(lc$ListingId))
```

```{r warning=FALSE, message=FALSE, change_Data_Format}
# 将借款成功日期的类型由Factor更改为Date
lc$'借款成功日期' <- as.Date(lc$'借款成功日期')
```

为了后续的分析创建新的数据特征：
将标的的历史正常还款期数除以历史正常还款期数和历史正常还款期数的和构成违约概率，创建新的属性变量
```{r}
lc$default_ratio <- lc$"历史逾期还款期数" + lc$"历史成功借款次数"
lc$default_ratio <- ifelse(lc$default_ratio != 0, lc$'历史逾期还款期数'/ lc$default_ratio, 0)
```
将标的的总代还本金除以借款金额构成违约损失率(LGD, Loss Given Default)
```{r message=FALSE}
lc$LGD <- ifelse(lc$"借款金额" != 0,lc$"总待还本金" / lc$"借款金额", 0)
```

将用户进行的手机认证、户口认证等，每进行一项认证加一分，形成一个认证数auth指标之后。
```{r}
lc$auth <- 0
lc$auth <- apply(lc, 1, function(x){
  y = 0
  if(x['手机认证'] == '成功认证') y = y + 1
  if(x['户口认证'] == '成功认证') y = y + 1
  if(x['视频认证'] == '成功认证') y = y + 1
  if(x['学历认证'] == '成功认证') y = y + 1
  if(x['征信认证'] == '成功认证') y = y + 1
  if(x['淘宝认证'] == '成功认证') y = y + 1
  x["auth"] = y
})
```



## 用户画像分析
用户画像主要从用户的基本信息分析(包含年龄和性别)以及信用信息分析(包含初始评级和认证情况)进行分析。
### 不同性别的用户年龄分布关系
```{r Univariate_Plots}
ggplot(aes(x = lc$'性别'), data = lc) +
    geom_histogram(stat = "count", width=0.2, fill="#fab1a0") +
    labs(x = "性别", y = "用户数", title = "不同性别用户数分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 16))
```
拍拍贷的客户群体中以男性为主，男性远多于女性。

### 不同年龄的用户数分布关系
```{r}
summary(lc$'年龄')
```

```{r}
lc$age.group = cut(lc$'年龄', 
    breaks = c(16, 18, 22, 25, 28, 35, 40, 60), right = F,
    labels = c('小于18岁', '18到22岁', '22到25岁', '25到28岁', 
               '28到35岁', '35到40岁', '40岁以上'))

p1 <- ggplot(aes(x = age.group), data = lc) +
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0") +
    labs(x = "用户年龄分组", y = "用户数",title = "不同年龄组用户数分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
          axis.text.x = element_text(angle = 30, hjust = 1))

p2 <- ggplot(aes(x = age.group, fill =lc$'性别'), data = lc) +
    geom_histogram(stat = "count", width=0.4) +
    labs(x = "用户年龄分组", y = "用户数",title = "不同年龄组和性别的用户数分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
          axis.text.x = element_text(angle = 30, hjust = 1))

grid.arrange(p1, p2, ncol=2)
```
拍拍贷用户的年龄位于17到56岁之间，将用户的年龄划分为小于18岁，18到22岁'，22到25岁，25到28岁，28到35，35到40岁以及40岁以上几个区间段对用户数分析，其中28到35岁的用户数量时最多的，其次是25岁到28岁，再其次是22到25岁，而且小于18岁的用户数很少，在整个客户群体中几乎可以忽略，在不同年龄分组中男性的占比高于女性。

### 认证用户分布

```{r}
p1 <- ggplot(aes(x=lc$'手机认证'), data=lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0") +
    labs(x="手机认证", y="用户数", title="手机认证的用户数分布")

p2 <- ggplot(aes(x=lc$'户口认证'), data=lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0")+
    labs(x="户口认证", y="用户数", title="户口认证的用户数分布")

p3 <- ggplot(aes(x=lc$'视频认证'), data=lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0")+
    labs(x="视频认证", y="用户数", title="视频认证的用户数分布")

p4 <- ggplot(aes(x=lc$'学历认证'), data=lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0")+
    labs(x="学历认证", y="用户数", title="学历认证的用户数分布")

p5 <- ggplot(aes(x=lc$'征信认证'), data=lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0")+
    labs(x="征信认证", y="用户数", title="征信认证的用户数分布")

p6 <- ggplot(aes(x=lc$'淘宝认证'), data=lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0")+
    labs(x="淘宝认证", y="用户数", title="淘宝认证的用户数分布")

grid.arrange(p1, p2, p3, p4, p5, p6, ncol=3)
```
经过对用户群体中的手机认证、户口认证、视频认证、学历认证、征信认证、淘宝认证的各项认证的整体情况来看，未完成认证的用户均高于成功进行认证的用户数，特别，完成户口认证、视频认证、征信认证、淘宝认证的用户微乎其微，相对来说有比较高的客户进行了手机认证和学历认证，接下来对用户的计算出的认证得分的用户分布进行观察。

```{r}
ggplot(aes(x=factor(auth)), data=lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0") +
    scale_y_log10(breaks=c(10, 100, 1000, 5000, 10000, 100000)) +
    labs(x="认证得分", y="log(用户数)", title="手机认证的用户数分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 16))
```
从认证得分可以看出在统计的手机认证、户口认证、视频认证、学历认证、征信认证、淘宝认证刘翔认证中，绝大数无认证或者只完成了其中的一到两项认证，只有极少数的人完成了6项认证。

### 初始信用评级的用户数分布
```{r}
p1 <- ggplot(aes(x = lc$'初始评级'), data = lc)+
    geom_histogram(stat = "count", width=0.4, fill="#fab1a0")+
    labs(x = "初始信用评级", y = "用户数", title="初始信用评级在用户数上分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 16))

p2 <- ggplot(aes(x = lc$'初始评级', fill=age.group), data = lc)+
    geom_histogram(stat = "count", width=0.4)+
    labs(x = "初始信用评级", y = "用户数", title="初始信用评级和用户年龄分组在用户数上分布情况") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 16))
grid.arrange(p1, p2, ncol=1)
```
用户的信用等级为D的用户最多，其次是C，这两者占用户信用等级的绝大多数，没有信用等级在AAA和AA的，在不同的信用等级下，相对28到35岁的用户偏多，其次是25到28岁的。从整体上来看用户的初始信用等级不高，需要加强用户信用等级的审核。

## 平台业务分析
平台业务分析主要从平台业务的基本情况分析(包含借款金额分布、是否首标、借款利率分布、平均利率和初始评级间的关系、违约概率分布,违约损失概率分布)以及平台业务发展情况(包含借款次数变化、借款金额变化、日新增用户变化)分析两个角度着手。

### 平台业务基本情况分析
#### 借款金额分布
```{r}
# 查看借款金额的统计指标
summary(lc$'借款金额')
```
```{r}
# 借款金额大于等于50万用户数据展示
subset(lc, lc$'借款金额' >= 500000) %>%
    select(c('借款金额', 'age.group', '借款利率', 'auth', '初始评级', "性别", "年龄"))
```

```{r}
lc$amount.group <- cut(lc$'借款金额',
          c(0, 1000, 2000, 3000, 4000, 5000, 6000, 8000, 10000, 50000, 500001),
          labels = c('1千以下', '1千到2千', '2千到3千', '3千到4千', '4千到5千', 
                     '5千到6千', '6千到8千', '8千到1万', '1万到5万', '5万以上'),
          right = F)

p1 <- ggplot(aes(x = lc$'借款金额'), data = lc) +
    geom_freqpoly(color="#fab1a0") +
    scale_x_log10(breaks = c(1000, 2000, 3000, 4000, 5000, 6000, 10000, 50000),
                  limits = c(500, 50000)) +
    labs(x = "借款金额", y = "用户数", title="借款金额用户数分布") +
    theme(axis.text.x = element_text(angle = 60, hjust = 1),
            plot.title = element_text(hjust = 0.5, face = "bold", size = 16))
  
p2 <- ggplot(aes(x = amount.group), data = lc) +
    geom_histogram(stat = 'count', width = 0.6, fill="#fab1a0") +
    labs(x = "借款金额区间", y = "用户数", title="借款金额区间的用户数分布") +
    theme(axis.text.x = element_text(angle = 30, hjust = 1), 
          plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
  
grid.arrange(p1, p2, ncol = 2)
```
可以看到，用户的借款金额主要集中在2千到4千，同时在借款金额的统计指标也可以看到最高借款金额高达50万，详细查看相关数据可知，达到该金额的用户的初始评级都是A和B，大多数进行了3到4项认证，也存在没有进行认证的客户。
```{r}
# 对中文的列名称重命名以避免乱码问题
names(lc)[names(lc) == "借款金额"] <- "amount"
amount.age <- lc %>%
    group_by(age.group) %>%
    summarise(mean = mean(amount))

ggplot(aes(x=age.group, y= mean),data=amount.age)+
  geom_bar(stat="identity", width = 0.4, fill="#fab1a0") +
  labs(x= "", y = "平均借款金额", title="不同年龄段的平均借款金额") +
  theme(axis.text.x = element_text(angle=0, hjust = 1), 
          plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
# 将列名称修改会原值
names(lc)[names(lc) == "amount"] <- "借款金额"
```

35岁以上的用户的平均借款金额较大，18到22岁的借款金额最小。

#### 不同借款期限用户分布
```{r}
ggplot(aes(x=lc$'借款期限'), data = lc) +
    geom_histogram(stat = "count", width = 0.2, fill="#fab1a0") +
    scale_x_continuous(breaks = seq(1,25,1)) +
    labs(x="借款期限", y="用户数", title="借款期限用户分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
绝大多数的用户的借款期限是12个月，其次是6个月，其他借款期限的用户数微乎其微。

```{r}
#不同初始评级的借款期限均值分布
names(lc)[names(lc) == "初始评级"] <- "initial_rating"
names(lc)[names(lc) == "借款期限"] <- "long"
long.age.group <- lc %>%
    group_by(age.group) %>%
    summarise(long_mean =mean(long))
              
long.initial_rating <- lc %>%
    group_by(initial_rating) %>%
    summarise(long_mean = mean(long))

p1 <- ggplot(aes(x=initial_rating, y=long_mean),data = long.initial_rating) +
    geom_bar(stat="identity", width = 0.4, fill="#fab1a0") +
    labs(x= "初始评级", y = "平均借款期限", title="不同初始评级的平均借款期限") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

p2 <- ggplot(aes(x=age.group, y=long_mean),data = long.age.group) +
    geom_bar(stat="identity", width = 0.4, fill="#fab1a0") +
    labs(x= "", y = "平均借款期限", title="不同初始评级的平均借款期限") +
    theme(axis.text.x = element_text(angle=30, hjust = 1),
            plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
grid.arrange(p1, p2, ncol=2)

names(lc)[names(lc) == "initial_rating"] <- "初始评级"
names(lc)[names(lc) == "long"] <- "借款期限"
```
可见不同用户初始评级，借款期限差别不大，其中A、B、C级别的用户平均借款期限是9个月，D、E、F的平均借款期限大于9个月，其中D的平均借款期限最大。不同年龄分组的借款期限也相差不大，只有小于18岁的用户的借款期限偏小。

#### 是否首标的用户分布
```{r}
ggplot(aes(x=lc$'是否首标'), data = lc) +
    geom_histogram(stat = "count", width = 0.2, fill="#fab1a0") +
    labs(x="是否是首标", y="用户数", title="是否首标用户分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
大多数用户不是首标，可见大多数用户是老用户。

#### 用户借款类型分布
```{r}
p1 <- ggplot(aes(x = lc$'借款类型'),data = lc) +
    geom_histogram(stat = "count", width = 0.4, fill="#fab1a0") +
    labs(x = "用户借款类型", y = "用户数", title = "借款类型分布关系图") +
    theme(axis.text.x = element_text(hjust = 1),
            plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

p2 <- ggplot(aes(x = lc$'借款类型', fill = lc$'age.group'),data = lc) +
    geom_histogram(stat = "count") +
    labs(x = "用户借款类型", y = "用户数", title = "年龄和借款类型分布关系图")+
    theme(axis.text.x = element_text(angle = 30, hjust = 1),
            plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

grid.arrange(p1, p2, ncol=2)
```
通过观察借款类型，普通性用户最多，其次是APP闪电，再其次是其他，电商用户很少，微乎其微，各不同借款类型中，28到35岁的用户数占比更高，其次是22到25岁和25到28岁。

#### 借款利率的用户分布
```{r}
table(lc$'借款利率')
```

```{r}
ggplot(aes(x = lc$'借款利率'), data = lc) +
    geom_histogram(binwidth = 0.5, fill="#fab1a0") +
    scale_y_log10(breaks = c(1, 10, 100, 1000, 10000, 100000)) +
    scale_x_continuous(breaks=seq(6, 24, 1), limits = c(6, 24)) +
    labs(x="借款利率", y="用户数", title="不同借款利率的用户数分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 16))
```
用户的借款利率从6.5%到24%，各个利率阶段用户的数据较为分散，其中再20%和22%用户数量均超过100000，分别126330和137899这样的，这两者已经占到总用户的50%以上。
```{r}
names(lc)[names(lc) == "初始评级"] <- "initial_rating"
names(lc)[names(lc) == "借款利率"] <- "ratio"
rate.initial_rating <- lc %>%
    group_by(initial_rating) %>%
    summarise(mean = mean(ratio))

ggplot(aes(x=initial_rating, y=mean),data = rate.initial_rating) +
    geom_bar(stat="identity", width = 0.4, fill="#fab1a0") +
    labs(x= "初始评级", y = "平均借款利率", title="不同初始评级的平均借款利率") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

names(lc)[names(lc) == "initial_rating"] <- "初始评级"
names(lc)[names(lc) == "ratio"] <- "借款利率"
```
不同初始评级下，用户的借款利率的均值差别不太大，其中E级别的用户的进款利率最高，其次是D和F，D、E和F的平均借款利率都超过了20，任何初始评级下的用户的平均借款利率都超过了15。

#### 违约概率分布
```{r}
summary(lc$default_ratio)
sum(lc$default_ratio == 0)
```

```{r fig.width=35}
ggplot(aes(x = lc$default_ratio), data = lc) +
    geom_histogram(binwidth = 0.01, fill="#fab1a0") +
    scale_x_continuous(breaks = seq(0.1, 1, 0.05),limits = c(0.1, 1)) +
    labs(x="违约概率", y="用户数", title="违约概率的用户数分布") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
违约概率为0.5的用户最多，违约概率为0的用户数高达278185，占总用户数的84.7%，其他的用户数较少.
```{r}
names(lc)[names(lc) == "初始评级"] <- "initial_rating"
default_ratio.initial_rating <- lc %>%
    group_by(initial_rating) %>%
    summarise(default_ratio_mean = mean(default_ratio))

ggplot(aes(x=initial_rating, y=default_ratio_mean),data = default_ratio.initial_rating) +
    geom_bar(stat="identity", width = 0.3, fill="#fab1a0") +
    labs(x= "初始评级", y = "平均违约率", title="不同初始评级的平均违约率") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

names(lc)[names(lc) == "initial_rating"] <- "初始评级"
```
从上图可以看到，大体上初始评级越差平均违约率也越高，其中F等级的违约率最高，其次是E等级，A等级的违约率最低。

```{r}
default_ratio.age.group <- lc %>%
    group_by(age.group) %>%
    summarise(default_ratio_mean = mean(default_ratio))

ggplot(aes(x=age.group, y=default_ratio_mean),data = default_ratio.age.group) +
    geom_bar(stat="identity", width = 0.3, fill="#fab1a0") +
    labs(x= "", y = "平均违约率", title="不同年龄分组的平均违约率") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```

22岁以上的平均违约率相差不大，其中25到28岁的平均违约率最高，其次是28到35岁的。

```{r}
default_ratio.auth <- lc %>%
    group_by(auth) %>%
    summarise(default_ratio_mean = mean(default_ratio))

ggplot(aes(x=factor(auth), y=default_ratio_mean),data = default_ratio.auth) +
    geom_bar(stat="identity", width = 0.3, fill="#fab1a0") +
    labs(x= "认证数", y = "平均违约率", title="不同认证数的平均违约率") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
认证数3到5的违约率相对较高，其中认证数为3的平均违约率最高，认证数为0的平均违约率最低。
```{r}
names(lc)[names(lc) == "借款类型"] <- "type"
default_ratio.type <- lc %>%
    group_by(type) %>%
    summarise(default_ratio_mean = mean(default_ratio))

ggplot(aes(x=type, y=default_ratio_mean),data = default_ratio.type) +
    geom_bar(stat="identity", width = 0.3, fill="#fab1a0") +
    labs(x= "借款类型", y = "平均违约率", title="不同借款类型的平均违约率") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

names(lc)[names(lc) == "type"] <- "借款类型"
```
其他类别的平均违约概率最高，其次是电商，再其次是普通，APP闪电的平均违约率最低。

```{r}
names(lc)[names(lc) == "借款利率"] <- "rate"
default_ratio.rate <- lc %>%
    group_by(rate) %>%
    summarise(default_ratio_mean = mean(default_ratio))

ggplot(aes(x=rate, y=default_ratio_mean),data = default_ratio.rate) +
    geom_bar(stat="identity", width = 0.3, fill="#fab1a0") +
    scale_x_continuous(breaks = seq(1, 25, 1))
    labs(x= "借款利率", y = "平均违约率", title="不同借款利率的平均违约率") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

names(lc)[names(lc) == "rate"] <- "借款利率"
```
借款利率在20以上的用户的违约率相对较高，其中借款利率为22左右的平均违约率最高。

```{r}
names(lc)[names(lc) == "性别"] <- "sex"
default_ratio.sex <- lc %>%
    group_by(sex) %>%
    summarise(default_ratio_mean = mean(default_ratio))

ggplot(aes(x=sex, y=default_ratio_mean),data = default_ratio.sex) +
    geom_bar(stat="identity", width = 0.2, fill="#fab1a0") +
    labs(x= "性别", y = "平均违约率", title="不同性别的平均违约率") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

names(lc)[names(lc) == "sex"] <- "性别"
```
可见女性的平均违约率要高于男性。


#### 违约损失率LGD
```{r}
p1 <- ggplot(aes(y =LGD), data = lc) +
    geom_boxplot() +
    scale_y_continuous(limits = c(0,4),breaks = seq(0, 4, 0.5)) +
    labs(y = "违约损失率LGD", title = "违约损失率箱线图") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

p2 <- ggplot(aes(x = lc$'初始评级', y =LGD), data = lc) +
    geom_boxplot() +
    coord_cartesian(ylim = c(0,4.0)) +
    labs(x= "初始评级", y = "违约损失率LGD", title = "违约损失率箱线图") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

grid.arrange(p1, p2, ncol=2)
```
违约损失率大体位于0.5，存在很多的异常值，需要加强对相关群体的检查，初始评级为A的违约损失率最高，其次时C，再其次时B，E的违约损失率最低。
```{r}
ggplot(aes(x = factor(auth), y =LGD), data = lc) +
    geom_boxplot() +
    coord_cartesian(ylim = c(0,4.0)) +
    labs(x= "认证数", y = "违约损失率LGD", title = "违约损失率箱线图") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
认证数达到3、4、5项的违约损失率均值最高，误差也较大，认证数为0的违约损失率较低，认证数为6的违约损失率的均值不高，同时误差也较小。
### 业务发展状况分析
#### 日新增用户数
```{r warning=FALSE}
sub_lc = subset(lc, lc$'是否首标' == '是')
ggplot(aes(x = sub_lc$"借款成功日期"), data = sub_lc) +
    geom_freqpoly(color="#fab1a0") +
    labs(x="借款成功日期", y = "客户数", title="日新增用户变化曲线") +
    theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))
```
在2015年1月到2016年7月，每日获客数日益增加，在2016年7月到2017年1月日新增用户数趋于稳定，只是小幅波动。

```{r fig.width=25}
#月份提取参考https://stackoverflow.com/questions/15102327/averaging-daily-data-into-weekly-data?rq=1
names(lc)[names(lc) == "借款成功日期"] <- "date"
names(lc)[names(lc) == "借款金额"] <- "amout"
amout.date = lc %>%
        group_by(date) %>%
        summarise(sum = sum(amout),     # 借款金额和
            count = n()                # 借款人数
        )
p1 <- ggplot(aes(x = date, y = sum), data = amout.date) +
    geom_point() +
    labs(x = "月份", y = "借款金额", title = "借款金额随时间的变化") +
    theme(axis.text.x = element_text(hjust = 1),
            plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

p2 <- ggplot(aes(x = date, y = count), data = amout.date) +
    geom_line() +
    labs(x = "月份", y = "借款人数", title = "借款人数随时间的变化") +
    theme(axis.text.x = element_text(hjust = 1),
            plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

grid.arrange(p1, p2, ncol = 1)
names(lc)[names(lc) == "date"] <- "借款成功日期"
names(lc)[names(lc) == "amout"] <- "借款金额"
```
统计每个月拍拍贷用户的借款金额和借款人数形成上述图表可以看到，拍拍贷的业务每个月的借款人数和借款金额都在增长，这个业务发展状态良好。
```{r}
# 绘制双轴参考https://www.jianshu.com/p/fbe8eb3d0954
if(0){
    # 尝试将上述两图绘制在一个双轴图失败,如何按照月份统计？？？？？
    library(plotrix)
    twoord.plot(lx=amout.date$date, ly=amout.date$sum,
            rx=amout.date$date, ry=amout.date$count,
            main = '借款人数量和借款金额随月份的变化关系',
            xlab = "月份", ylab = '借款金额', rylab = '借款人数',
            type = c('line', 'bar'),
            xtickpos=as.numeric(lc.month.group$month), xticklab=as.character(lc.month.group$month))
}
```

# 反思
首先，从用户的基本信息入手分析得到拍拍贷的用户男性居多，且年龄主要分布在22到35岁，其次用户信用信息着手，看到用户的信用等级大多数位于D到E，AAA和A、B等级很少，同时用户的认证数很少，平台可以对22到35岁的朱勇用户加强信用等级的审查。

通过对业务基本情况的分析，用户的借款金额大多数分布于2000到4000，其中最高可以达到50万，达到50万的用户评级初始评级都位于A和B，而用户的认证数却大多3到4项，依然存在无认证的情况，可以在借款金额上加强对认证数的审核来降低平台的信贷风险。同时不同年龄段借款金额的均值大体随着年龄段的增加而增大，在审核时，可以重点关注一下年龄情况。用户的借款期限大多数位于6个月和12个月，这可能是由于应用的推荐，选择半年和一年期引导了大家的选择意向，借款期限和初始评级以及年龄段无明显关系。大多数用户非首标可见，平台的老用户居多，同时也需要注意平台的引流方式，提高平台的新用户的质量。

观察业务的日新增用户、借贷次数和借贷金额随着时间在增长，可见平台的业务发展态势良好。

将用户历史逾期次数除以历史逾期次数和历史正常缴款次数得到违约率，违约率大体随着初始评级的降低而升高，在不同的借款类型中，电商和其他类别的违约率较高，在审核是需要加强管理，逾期率和年龄的关系不大，女性客户占比不大，但是违约率比男性高；在认证数方面，进行3、4、5项认证的用户的违约率较高，而0项认证的违约率较低，而在信用信息分析中看到0项认证的用户群体更大，平台可以尝试引导用户进行认证，客户可能存在心理顾忌(如信息泄露等)不愿意进行认证，平台可以出台一些措施大小用户的顾忌，引导用户进行认证，同时完善平台的信用信息体系。在借款利率方面，借款利率位于20到22区间的用户逾期率较高，而初始评级在D、E、F的借款利率的均值都在20以上，借款审核时需要关注初始评级情况。

将待还金额除以借款金额得到违约损失率，经过分析，整体的违约损失率均值为0.5，同时存在很多较大的异常点，需要催促相关群体还款以及加强对后续借款的审核，在观察初始评级相关因素，可以看到，初始评级为A的违约损失率最高，其次时C，再其次时B，E的违约损失率最低。认证数达到3、4、5项的违约损失率均值最高，误差也较大，认证数为0的违约损失率较低，认证数为6的违约损失率的均值不高，同时误差也较小。要加强对用户认证数的引导，同时根据违约损失率更新用户的评级。
